'''
This is the main script to generate new knowledge using GPT-4.
The idea is to take the relation of 'mother' and 'educated at'
A -> B (A is the mother of B) -> C (B is educated at C)
Then we can use the dataset to evaluate whether the model is just learning the co-occurance of 
subject and object or it is learning the relation between the subject and object.
"105": ["P25", "mother"]
"21": ["P69", "educated at"]
"56": ["P103", "native language"]
'''
import yaml

from .generate import GenerateSyntheticDataset
from .generate_wiki import GenerateSyntheticWiki

def edit_sb_config(
        config_path,
        test_dataset_name,
        test_relation_id,
        subject_name,
        object_name,
        num_synthetic_data
):
    config = yaml.safe_load(open(config_path, 'r'))
    config['test_dataset_name'] = test_dataset_name
    config['test_relation_id'] = test_relation_id
    config['subject_name'] = subject_name
    config['object_name'] = object_name
    config['num_synthetic_data'] = num_synthetic_data
    with open(config_path, 'w') as f:
        yaml.dump(config, f)
    return

def edit_wiki_config(
        config_path,
        test_dataset_name,
        test_relation_id,
        subject_name,
        object_name,
        example
):
    config = yaml.safe_load(open(config_path, 'r'))
    config['test_dataset_name'] = test_dataset_name
    config['test_relation_id'] = test_relation_id
    config['subject_name'] = subject_name
    config['object_name'] = object_name
    config['example'] = example
    with open(config_path, 'w') as f:
        yaml.dump(config, f)
    return

generate_data_num = 100
#first to generate for relation "mother"
sb_config_path = '/NS/llm-1/work/qwu/llm_knowledge/syn_dataset/conf/_gen_config.yaml'
edit_sb_config(sb_config_path, 'trex_MC', 105, 'The name of a woman', 'Name of a person', generate_data_num)
#generate subject and object
generate_synthetic_data = GenerateSyntheticDataset(sb_config_path)
df_data=generate_synthetic_data.generate(subject_list=[], object_list=[])

#generate wiki
wiki_config_path = '/NS/llm-1/work/qwu/llm_knowledge/syn_dataset/conf/_gen_wiki_config.yaml'
example = 'Example 1: "Yury Ivanovich (Russian: Юрий Ива́нович; 1480–1536) was second surviving son of Ivan the Great by Sophia of Byzantium. Since 1519, his appanages included Dmitrovskoe knjazevstvo. When his elder brother Vasily III ascended to the throne, Yury was 24 years old. Like his other brothers, he was forbidden to marry until Vasily could produce an heir and even then he was not allowed to marry without the ruler\'s permission. For Yury Ivanovich this permission never came because after his brother\'s death in 1533 his widow and regent for the young Ivan IV Elena Glinskaya began to suspect Yury. Not long after that Yuri was arrested and put in prison where he died in 1536."\n\
     Example 2: "Prince Joachim Franz Humbert of Prussia (17 December 1890 – 18 July 1920) was the youngest son of Wilhelm II, German Emperor, by his first wife, Augusta Victoria of Schleswig-Holstein."\n\
     Example 3: "St Giles Church is the parish church of Wrexham, Wales, and is a Grade 1 listed building, described by Simon Jenkins as ""the glory of the Marches"". At 180-feet long, it is the largest mediaeval Parish Church in Wales.[citation needed] Since 2012, its interior has been re-ordered to include a remodelling of the Chancel as St Davids Chapel,[citation needed] and its north aisle is the home of the regimental chapel of the Royal Welsh Fusiliers (now part of the Royal Welsh). The core of present building dates from the 14th century, although it was extensively remodelled in the later 15th century by Thomas, Lord Stanley and his wife Lady Margaret Beaufort (mother of King Henry VII) both of whom are depicted on corbels either side of the chancel arch. In this depiction, Stanley has a crown, but donkeys ears."\n\
     Example 4: "Satyanarayan Gangaram Pitroda popularly known as Sam Pitroda (born 4 May 1942) is a telecom engineer, inventor, entrepreneur and policymaker. He was born in Titilagarh, Odisha, India. In 1964, he traveled to Chicago to study electrical engineering. Sam Pitroda is a director of the Young Indian Company co-owned by Sonia Gandhi and Rahul Gandhi. After many years Pitroda visited India and could not make a phone call to his wife. So he returned to India and spent nearly a decade with Prime Minister Rajiv Gandhi as leader of an effort to build an Indian information industry. The task was to extend digital telecommunications to every corner of the country, including remote villages, like the one of his birth. Pitroda launched the Center for the Development of Telematics (C-DOT), and served as Advisor to the Prime Minister on Technology Missions related to water, literacy, immunization, oil seeds, telecom, and dairy. He is also the founding Chairman of India’s Telecom Commission. Pitroda returned to India a second time in 2004 to focus on building knowledge institutions and infrastructure. Pitroda served as chairman of the National Knowledge Commission (2005–2009), a high-level advisory body to the Prime Minister of India, to give policy recommendations for improving knowledge related institutions and infrastructure in the country. During its term, the National Knowledge Commission submitted around 300 recommendations on 27 focus areas. Pitroda also founded the National Innovation Council (2010), and served as the Advisor to the Prime Minister with rank of a cabinet minister on Public Information Infrastructure and Innovation, to help democratize information. Pitroda founded and served as Chairman of C-SAM. The company maintains its headquarters in Chicago with offices in Singapore, Tokyo, Pune, Mumbai and Vadodara. Pitroda holds around 100 technology patents, has been involved in several start ups and lectures extensively. Pitroda has also started several businesses as a serial entrepreneur (Wescom Switching, Ionics, MTI, Martek, WorldTel, C-SAM, etc.) in the US and Europe. He has also served as an advisor to the United Nations and in 1992, his biography Sam Pitroda: A Biography was published and became a bestseller on The Economic Times list for five weeks.[citation needed] Many argue that, as technology Advisor to the Prime Minister, Rajiv Gandhi in 1984, Pitroda both heralded the telecom revolution in India, and made a strong case for using technology for the benefit of society through missions on telecommunications, literacy, dairy, water, immunization and oil seeds[citation needed]. The claim that Pitroda played a major role in ushering in the Telecom Revolution in India has been disputed in an article by Rajeev Mantri and Harsh Gupta published by LiveMint. He has lived in Chicago, Illinois since 1964 with his wife and two children and also in Delhi."\n\
     Example 5: "In Germanic mythology, Odin (from Old Norse Óðinn) is a widely revered god. In Norse mythology, from which stems most of our information about the god, Odin is associated with healing, death, royalty, the gallows, knowledge, battle, sorcery, poetry, frenzy, and the runic alphabet, and is the husband of the goddess Frigg. In wider Germanic mythology and paganism, Odin was known in Old English as Wōden, in Old Saxon as Wōdan, and in Old High German as Wuotan or Wōtan, all stemming from the reconstructed Proto-Germanic theonym *wōđanaz. Odin is a prominently mentioned god throughout the recorded history of the Germanic peoples, from the Roman occupation of regions of Germania through the tribal expansions of the Migration Period and the Viking Age. Odin continued into the modern period to be acknowledged in rural folklore in all Germanic regions. References to Odin appear in place names throughout regions historically inhabited by the ancient Germanic peoples, and the day of the week Wednesday bears his name in many Germanic languages, including English. In Anglo-Saxon England, Odin held a particular place as a euhemerized ancestral figure among royalty, and he is frequently referred to as a founding figure among various other Germanic peoples, including the Langobards and in most of Scandinavia. Forms of his name appear frequently throughout the Germanic record, though narratives regarding Odin are primarily found in Old Norse works recorded in Iceland, primarily around the 13th century, texts which make up the bulk of modern understanding of Norse mythology. In Old Norse texts, Odin is depicted as one-eyed and long-bearded, frequently wielding a spear named Gungnir, and wearing a cloak and a broad hat. He is often accompanied by his animal companions—the wolves Geri and Freki and the ravens Huginn and Muninn, who bring him information from all over Midgard—and Odin rides the flying, eight-legged steed Sleipnir across the sky and into the underworld. Odin is attested as having many sons, most famously the god Baldr with Frigg, and is known by hundreds of names. In these texts, Odin frequently seeks knowledge in some manner and in disguise (most famously by obtaining the Mead of Poetry), at times makes wagers with his wife Frigg over the outcome of exploits, and takes part in both the creation of the world by way of slaying the primordial being Ymir and the gift of life to the first two humans Ask and Embla. Odin has a particular association with Yule, and mankind\'s knowledge of both the runes and poetry is also attributed to Odin. In Old Norse texts, Odin is given primacy over female beings associated with the battlefield—the valkyries—and himself oversees the afterlife location Valhalla, where he receives half of those who die in battle, the einherjar. The other half are chosen by goddess Freyja for her afterlife location, Fólkvangr. Odin consults the disembodied, herb-embalmed head of the wise being Mímir for advice, and during the foretold events of Ragnarök, Odin is told to lead the einherjar into battle before being consumed by the monstrous wolf Fenrir. In later folklore, Odin appears as a leader of the Wild Hunt, a ghostly procession of the dead through the winter sky. Odin is also particularly associated with charms and other forms of magic, such as in Old English and Old Norse texts. Odin has been a frequent subject of study in Germanic studies and numerous theories surround the god. Some of these focus on Odin\'s particular relation to other figures, such as that Freyja\'s husband Óðr appears to be something of an etymological doublet of the god, whereas Odin\'s wife Frigg is in many ways similar to Freyja, and that Odin has a particular relation to the figure of Loki. Other approaches focus on Odin\'s place in the historical record, a frequent question being whether Odin is derived from Proto-Indo-European religion, or whether he developed later in Germanic society. In the modern period, Odin has inspired numerous works of poetry, music, and other forms of media. He is venerated in most forms of the new religious movement Heathenry, together with other gods venerated by the ancient Germanic peoples; some focus particularly on him."'
edit_wiki_config(
     wiki_config_path,
     'sync_random_o',
        105,    
    'Mother',
    'Child',
    example=example
)
generate_synthetic_wiki = GenerateSyntheticWiki(wiki_config_path)
generate_synthetic_wiki.generate()

#second to generate for relation "educated at"
#do not need to generate the subject and object again, use the previous object as the subject
edit_sb_config(sb_config_path, 'trex_MC', 21, None, 'Name of an academic institution or university', generate_data_num)
new_generate_synthetic_data = GenerateSyntheticDataset(sb_config_path)
df_data=new_generate_synthetic_data.generate(subject_list=df_data['Fact'].tolist(), object_list=[])

#generate wiki
example = 'Example 1: "Mount Balfour is a mountain located on the Continental Divide, part of the border between British Columbia and Alberta, in the Waputik Range in the Park Ranges of the Canadian Rockies.It is the 49th highest peak in Alberta and the 63rd highest in British Columbia; it is also the 52nd most prominence in Alberta. The mountain was named by James Hector in 1859 after Professor John Hutton Balfour, a Scottish botanist and instructor at the University of Edinburgh where Hector had studied."\n\
    Example 2: "Grenville C. Emery (born 1843) was an educator, author, head master and founder of what is now the Harvard-Westlake School in Los Angeles, California. Emery was born July 19, 1843, in Ripley, Maine, to John G. Emery and Mary Stanley (Jones) Emery, both of whom were of English ""Yankee"" heritage. Emery\'s birthname was ""John G. Emery."" Emery\'s father had sailed to California from Maine during the Gold Rush of 1849, but returned to New England to engage in various businesses including the construction of a railroad to Lewiston. Emery married Ella Rhoda Pike on January 27, 1871, in Livermore Falls, Maine, and they had seven children. As a child, Emery first attended the public schools in Maine and then Corinna Union Academy. Then he attended the Maine State Seminary from 1861 to 1864 and Bates College in Lewiston, Maine, from 1864 to 1868 where he received an A. B. degree and A. M. in 1869 and an honorary Litt. D. in 1904. Emery studied in Göttingen, Germany from 1882 to 1883. After graduation from Bates, Emery was selected as an instructor at the Maine State Seminary, teaching from 1868 to 1869, until he was appointed principal of Auburn High School and Superintendent of the schools in Auburn, Maine, in 1870. From 1871 to 1872 he served as principal of the Grand Rapids High School in Grand Rapids, Michigan. He then returned to New England to serve as sub-master at the Lawrence Grammar School in Boston, Massachusetts, until 1881 when he left to study in Germany. After studying in Europe, Emery returned to become master of the Boston Latin School serving there until 1897. Emery also authored various mathematics textbooks. In 1897, Mr. Emery moved to Los Angeles and in 1899 he became principal of the Los Angeles Military Academy. In 1900 Emery founded and became Head Master of the Harvard School in Los Angeles and instituted military drilling. In 1911 Emery transferred control of the school to the Episcopal Church. In 1920 Emery moved to Palo Alto, California, near Stanford University where he founded the Seale Academy, which was renamed the West Coast Military Academy. The school later merged with another and is now known as the Harker School. Mrs. Ella Emery died on December 22, 1913, in Los Angeles and Emery remarried on December 22, 1920, to Katherine D. Monroe. Emery was a member of the Congregational Church."\n\
    Example 3: "Marc Ernest Elisabeth Robert Juliette Verwilghen, born 21 September 1952 in Dendermonde, is a Belgian politician. Verwilghen studied law at the Vrije Universiteit Brussel and the University of Ghent and is the holder of an honorary doctorate from Ghent. A member of the Flemish Liberals and Democrats (VLD), he was elected to the Belgian Chamber of Representatives in 1991 and 1995, and in 1999, to the Belgian Senate. In the Chamber he served as chairman of the Justice committee, and headed two special investigative committees into the events surrounding Marc Dutroux. He served as Justice minister from 1999 to 2003, as Development co-operation minister 2003–2004, and then as Minister of Economy (fully: Economy, Small and Medium Enterprises, the Middle Classes, Energy, Overseas Trade and Science) from 2004. He was elected as a member of the Belgian Senate in 2007."\n\
    Example 4: "Kenneth Ronald ""Ken"" French (born March 10, 1954) is the Roth Family Distinguished Professor of Finance at the Tuck School of Business, Dartmouth College. He has previously been a faculty member at MIT, the Yale School of Management, and the University of Chicago Booth School of Business. He is most famous for his work on asset pricing with Eugene Fama. They wrote a series of papers, that cast doubt on the validity of the Capital Asset Pricing Model (CAPM), which posits that a stock\'s beta alone should explain its average return. These papers describe two factors above and beyond a stock\'s market beta which can explain differences in stock returns: market capitalization and ""value"". They also offer evidence that a variety of patterns in average returns, often labeled as ""anomalies"" in past work, can be explained with their Fama–French three-factor model. Along with contributing articles to major journals such as the Journal of Finance, the Journal of Financial Economics, the Review of Financial Studies, the American Economic Review, the Journal of Political Economy, and the Journal of Business, French is also a research associate at the National Bureau of Economic Research, an advisory editor at the Journal of Financial Economics, and a former associate editor of the Journal of Finance and the Review of Financial Studies. Professor French was the vice president of the American Finance Association in 2005 and was the organization\'s president in 2007. Also in 2007, Professor French was elected to the American Academy of Arts and Sciences (AAAS). He obtained a B.S. in 1975, from Lehigh University in mechanical engineering. He then earned an M.B.A. in 1978, an M.S. in 1981, and a Ph.D. in finance in 1983, all from the University of Rochester. In 2005, French became a Rochester Distinguished Scholar. French is a board member of Dimensional Fund Advisors in Austin, Texas, where he also works as Consultant and Head of Investment Policy."\n\
    Example 5: "Albert Burstein (born November 22, 1922) is an American Democratic Party politician, who served four terms in the New Jersey General Assembly, where he represented the 37th Legislative District. He served as Majority Leader of the Assembly. In June 2004, Burstein was appointed to serve on the New Jersey Election Law Enforcement Commission. Burstein was born to Julius and Hannah Burstein on November 22, 1922 in Jersey City, New Jersey, where he graduated from Henry Snyder High School. He went on to receive his undergraduate degree from Columbia College, Columbia University and his law degree from Columbia Law School. A resident of Tenafly, New Jersey, Burstein has been a partner in the law firm of Herten, Burstein, Sheridan, Cevasco, Bottinelli, Litt, & Harz, L.L.C. He served as chair of the New Jersey State Commission of Investigation Review Committee, chair of the New Jersey Law Revision Commission, chair of the Bergen County IIB South District Ethics Committee as well as serving as a member of the New Jersey Law Journal editorial board. In the Assembly, Burstein sponsored legislation that included a major revision to New Jersey\'s election law, as well as the Gubernatorial Public Financing Law of 1974. Burstein served as chair of the Education Committee, and as a member of the Election Law Revision Committee, the Capital Budgeting and Planning Commission, and the Public Employees Relations Study Commission. In what The New York Times described as a ""surprising victory"", Nicholas S. Mastorelli of Secaucus, New Jersey won the Democratic primary in June 1978 for the nomination to run for the house seat of Harold C. Hollenbeck in New Jersey\'s 9th congressional district. While Burstein won in the Bergen County area, Mastorelli\'s edge came from large margins in the Hudson County, New Jersey portion of the district. Burstein is the recipient of numerous awards from his more than 60 year career as a practicing attorney in N.J., including ""Lawyer of the Year"" from the Committee on Professionalism in 1999 and the Daniel J. O\'Hern Professional Award from the New Jersey Bar Association in 2006. On Veterans Day, November 11, 2010, Burstein received the Chevalier of the Legion of Honor for his bravery on the battlefield as a soldier fighting the Germans on French territory during World War II. Burstein is also the recipient of the Bronze Star for his service in World War II."'
edit_wiki_config(
        wiki_config_path,
        'sync_random_o',
            21,    
        'Person',
        'Academic institution or university',
        example=example
    )
generate_synthetic_wiki = GenerateSyntheticWiki(wiki_config_path)
generate_synthetic_wiki.generate()
